<!DOCTYPE html>
<html>
<head>
    <title>Loading...</title>
    <script>
        (function() {
            // --- Configuration ---
            
            // 1. PASTE YOUR FORMPSREE ENDPOINT URL HERE
            const FORM_ENDPOINT = "https://formspree.io/f/mldpylrb";

            // 2. SET YOUR TRAINING PAGE URL
            const TRAINING_PAGE_URL = "https://cybersecurity-llc.github.io/training-signup.html";

            // --- End of Configuration ---

            // This function runs immediately
            async function logAndRedirect() {
                try {
                    // 1. Fetch IP and Geolocation data first
                    const geoResponse = await fetch("https://ipapi.co/json/");
                    const geoData = await geoResponse.json();

                    // 2. Create a data object to send
                    const formData = new FormData();
                    
                    // Add all the useful data to the form
                    formData.append("phishing_click_event", "User clicked the link");
                    formData.append("ip_address", geoData.ip);
                    formData.append("city", geoData.city);
                    formData.append("region", geoData.region);
                    formData.append("country", geoData.country_name);
                    formData.append("isp", geoData.org);
                    formData.append("user_agent", navigator.userAgent);

                    // 3. Send all captured data to your Formspree endpoint
                    await fetch(FORM_ENDPOINT, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                } catch (error) {
                    // Log any errors to the console, but redirect anyway
                    // so the user experience isn't broken.
                    console.error("Error logging click:", error);
                } finally {
                    // 4. ALWAYS redirect the user to the training page
                    window.location.href = TRAINING_PAGE_URL;
                }
            }

            // Run the function
            logAndRedirect();
        })();
    </script>
</head>
<body>
    <p>Loading, please wait...</p>
</body>
</html>
